<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Dagger2-å…¥é—¨ï¼Œä»¥åˆå­¦è€…è§’åº¦ - Fxzou Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Fxzou"><meta name=description content="Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶, æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦æ¥å­¦ä¹ Dagger2ã€‚"><meta name=keywords content="Fxzou,blog,zFxiang"><meta name=generator content="Hugo 0.82.0 with theme even"><link rel=canonical href=https://zfxiang.github.io/post/android/dagger2/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.39a3e01cac9473be1356f3572fcfe34b2e363efabad244a99a40f28a812c837e.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Dagger2-å…¥é—¨ï¼Œä»¥åˆå­¦è€…è§’åº¦"><meta property="og:description" content="Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶, æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦æ¥å­¦ä¹ Dagger2ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://zfxiang.github.io/post/android/dagger2/"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-09-25T15:43:48+08:00"><meta property="article:modified_time" content="2016-12-21T15:43:48+08:00"><meta itemprop=name content="Dagger2-å…¥é—¨ï¼Œä»¥åˆå­¦è€…è§’åº¦"><meta itemprop=description content="Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶, æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦æ¥å­¦ä¹ Dagger2ã€‚"><meta itemprop=datePublished content="2016-09-25T15:43:48+08:00"><meta itemprop=dateModified content="2016-12-21T15:43:48+08:00"><meta itemprop=wordCount content="13722"><meta itemprop=keywords content="Dagger2,æ•™ç¨‹,Android,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dagger2-å…¥é—¨ï¼Œä»¥åˆå­¦è€…è§’åº¦"><meta name=twitter:description content="Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶, æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦æ¥å­¦ä¹ Dagger2ã€‚"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Fxzou</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>ä¸»é¡µ</li></a><a href=/post/><li class=mobile-menu-item>å½’æ¡£</li></a><a href=/tags/><li class=mobile-menu-item>æ ‡ç­¾</li></a><a href=/categories/><li class=mobile-menu-item>åˆ†ç±»</li></a><a href=/about/><li class=mobile-menu-item>å…³äºæˆ‘</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Fxzou</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>ä¸»é¡µ</a></li><li class=menu-item><a class=menu-item-link href=/post/>å½’æ¡£</a></li><li class=menu-item><a class=menu-item-link href=/tags/>æ ‡ç­¾</a></li><li class=menu-item><a class=menu-item-link href=/categories/>åˆ†ç±»</a></li><li class=menu-item><a class=menu-item-link href=/about/>å…³äºæˆ‘</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Dagger2-å…¥é—¨ï¼Œä»¥åˆå­¦è€…è§’åº¦</h1><div class=post-meta><span class=post-time>2016-09-25</span><div class=post-category><a href=/categories/android/>Android</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>æ–‡ç« ç›®å½•</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#ä¾èµ–æ³¨å…¥>ä¾èµ–æ³¨å…¥</a></li><li><a href=#dagger2ä»‹ç»>Dagger2ä»‹ç»</a></li><li><a href=#ä¹¦å†™demo>ä¹¦å†™Demo</a><ul><li><a href=#å¼•å…¥dagger2>å¼•å…¥Dagger2</a></li><li><a href=#ç¼–å†™å¸ƒæ–™ç±»cloth>ç¼–å†™å¸ƒæ–™ç±»Cloth</a></li><li><a href=#ä¹¦å†™moduleç±»>ä¹¦å†™Moduleç±»</a></li><li><a href=#ä¹¦å†™componentæ¥å£>ä¹¦å†™Componentæ¥å£</a></li><li><a href=#åœ¨mainactivityä¸­å£°æ˜>åœ¨MainActivityä¸­å£°æ˜</a></li><li><a href=#ç»“æœ>ç»“æœ</a></li></ul></li><li><a href=#å¦ä¸€ç§æ–¹æ³•>å¦ä¸€ç§æ–¹æ³•</a><ul><li><a href=#åˆ›å»ºä¾èµ–ç±»shoe>åˆ›å»ºä¾èµ–ç±»Shoe</a></li><li><a href=#åœ¨mainactivityä¸­å£°æ˜shoeä¾èµ–>åœ¨MainActivityä¸­å£°æ˜Shoeä¾èµ–</a></li><li><a href=#ç»“æœ-1>ç»“æœ</a></li><li><a href=#æ³¨æ„>æ³¨æ„</a></li></ul></li><li><a href=#å¤æ‚ä¸€ç‚¹çš„æƒ…å†µ>å¤æ‚ä¸€ç‚¹çš„æƒ…å†µ</a><ul><li><a href=#åˆ›å»ºä¾èµ–ç±»clothes>åˆ›å»ºä¾èµ–ç±»Clothes</a></li><li><a href=#åœ¨moduleç±»ä¸­å¢åŠ æä¾›æ–¹æ³•>åœ¨Moduleç±»ä¸­å¢åŠ æä¾›æ–¹æ³•</a></li><li><a href=#åœ¨mainactivityä¸­å£°æ˜clothesä¾èµ–>åœ¨MainActivityä¸­å£°æ˜Clothesä¾èµ–</a></li><li><a href=#ç»“æœ-2>ç»“æœ</a></li></ul></li><li><a href=#ä¾èµ–æ€»ç»“>ä¾èµ–æ€»ç»“</a></li><li><a href=#namedå’Œqulifieræ³¨è§£çš„ä½¿ç”¨>@Namedå’Œ@Qulifieræ³¨è§£çš„ä½¿ç”¨</a><ul><li><a href=#named>@Named</a></li><li><a href=#ç»“æœ-3>ç»“æœ</a></li><li><a href=#qulifier>@Qulifier</a></li></ul></li><li><a href=#singletonå’Œscopeçš„ä½¿ç”¨>@Singletonå’Œ@Scopeçš„ä½¿ç”¨</a><ul><li><a href=#singleton>@Singleton</a></li><li><a href=#scope>@Scope</a></li></ul></li><li><a href=#ç»„ä»¶ä¾èµ–dependenciesçš„ä½¿ç”¨>ç»„ä»¶ä¾èµ–dependenciesçš„ä½¿ç”¨</a></li><li><a href=#subcomponentæ³¨è§£>@Subcomponentæ³¨è§£</a></li><li><a href=#lazyä¸provider>Lazyä¸Provider</a></li><li><a href=#componentçš„ç”Ÿå‘½å‘¨æœŸ>Componentçš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li><li><a href=#å£°æ˜>å£°æ˜</a></li><li><a href=#å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« </a></li></ul></li></ul></nav></div></div><div class=post-outdated><div class=warn><p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class=timeago datetime=2016-12-21T15:43:48 title="December 21, 2016">December 21, 2016</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p></div></div><div class=post-content><p>Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶, æœ¬æ–‡å°†ä»åˆå­¦è€…çš„è§’åº¦æ¥å­¦ä¹ Dagger2ã€‚</p><blockquote><p>2016-12-21 æ›´æ–°:æ·»åŠ @Subcomponentæ³¨è§£ä»¥åŠLazyä¸Providerçš„ä½¿ç”¨,æœ¬æ–‡åŸºæœ¬å®Œç»“!å¦‚æœæœ‰å¥½çš„å»ºè®®è¯·æå‡º,æ„Ÿè°¢å¤§å®¶çš„æ”¯æŒ,è°¢è°¢</p></blockquote><h2 id=ä¾èµ–æ³¨å…¥>ä¾èµ–æ³¨å…¥</h2><p>Dagger2æ˜¯Androidä¸­æ¯”è¾ƒçƒ­é—¨çš„ä¾èµ–æ³¨å…¥æ¡†æ¶,ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥å‘¢?ç»´åŸºç™¾ç§‘ä¸Šæ˜¯è¿™æ ·æè¿°çš„:</p><blockquote><p>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œç¼©å†™ä¸ºIoCï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å«â€œä¾èµ–æŸ¥æ‰¾â€ï¼ˆDependency Lookupï¼‰ã€‚é€šè¿‡æ§åˆ¶åè½¬ï¼Œå¯¹è±¡åœ¨è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªè°ƒæ§ç³»ç»Ÿå†…æ‰€æœ‰å¯¹è±¡çš„å¤–ç•Œå®ä½“ï¼Œå°†å…¶æ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ä¼ é€’ç»™å®ƒã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œä¾èµ–è¢«æ³¨å…¥åˆ°å¯¹è±¡ä¸­.</p></blockquote><p>é€šä¿—çš„æ¥è®²å‘¢,å°±æ˜¯ä¸€ä¸ªç±»ä¸­éœ€è¦ä¾èµ–å…¶ä»–å¯¹è±¡æ—¶,ä¸éœ€è¦ä½ äº²è‡ªä¸ºé‚£äº›éœ€è¦ä¾èµ–çš„å¯¹è±¡èµ‹å€¼,ä¸ºé‚£äº›å¯¹è±¡èµ‹å€¼çš„æ“ä½œäº¤ç»™äº†IOCæ¡†æ¶.</p><h2 id=dagger2ä»‹ç»>Dagger2ä»‹ç»</h2><p>ä¸€èˆ¬çš„IOCæ¡†æ¶éƒ½æ˜¯é€šè¿‡åå°„æ¥å®ç°çš„,ä½†Dagger2ä½œä¸ºAndroidç«¯çš„IOCæ¡†æ¶,ä¸ºäº†ä¸å½±å“æ€§èƒ½,å®ƒæ˜¯é€šè¿‡aptåŠ¨æ€ç”Ÿæˆä»£ç æ¥å®ç°çš„.
Dagger2ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—:</p><ol><li>ä¾èµ–æä¾›æ–¹Module,è´Ÿè´£æä¾›ä¾èµ–ä¸­æ‰€éœ€è¦çš„å¯¹è±¡,å®é™…ç¼–ç ä¸­ç±»ä¼¼äºå·¥å‚ç±»</li><li>ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹,å®ƒå£°æ˜ä¾èµ–å¯¹è±¡,å®ƒåœ¨å®é™…ç¼–ç ä¸­å¯¹åº”ä¸šåŠ¡ç±»,ä¾‹å¦‚Activity,å½“ä½ åœ¨Activityä¸­éœ€è¦æŸä¸ªå¯¹è±¡æ—¶,ä½ åªè¦åœ¨å…¶ä¸­å£°æ˜å°±è¡Œ,å£°æ˜çš„æ–¹æ³•åœ¨ä¸‹é¢ä¼šè®²åˆ°.</li><li>ä¾èµ–æ³¨å…¥ç»„ä»¶Component,è´Ÿè´£å°†å¯¹è±¡æ³¨å…¥åˆ°ä¾èµ–éœ€æ±‚æ–¹,å®ƒåœ¨å®é™…ç¼–ç ä¸­æ˜¯ä¸€ä¸ªæ¥å£,ç¼–è¯‘æ—¶Dagger2ä¼šè‡ªåŠ¨ä¸ºå®ƒç”Ÿæˆä¸€ä¸ªå®ç°ç±».</li></ol><p>Dagger2çš„ä¸»è¦å·¥ä½œæµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥:</p><ol><li>å°†ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹ä¼ å…¥ç»™Componentå®ç°ç±»</li><li>Componentå®ç°ç±»æ ¹æ®ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹ä¸­ä¾èµ–å£°æ˜,æ¥ç¡®å®šè¯¥å®ä¾‹éœ€è¦ä¾èµ–å“ªäº›å¯¹è±¡</li><li>ç¡®å®šä¾èµ–å¯¹è±¡å,Componentä¼šåœ¨ä¸è‡ªå·±å…³è”çš„Moduleç±»ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰æä¾›è¿™äº›ä¾èµ–å¯¹è±¡çš„æ–¹æ³•,æœ‰çš„è¯å°±å°†Moduleç±»ä¸­æä¾›çš„å¯¹è±¡è®¾ç½®åˆ°ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹ä¸­</li></ol><p>é€šä¿—ä¸Šæ¥è®²å°±å¥½æ¯”ä½ ç°åœ¨éœ€è¦ä¸€ä»¶è¡£æœ,è‡ªå·±åšå¤ªéº»çƒ¦äº†,ä½ å°±å»å•†åº—ä¹°,ä½ è·Ÿå•†åº—è€æ¿è¯´æ˜ä½ æƒ³è¦è´­ä¹°çš„ç±»å‹å,å•†åº—è€æ¿å°±ä¼šåœ¨è‡ªå·±çš„è¡£æœä¾›åº”å•†ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰ä½ æ‰€è¯´çš„ç±»å‹,æœ‰å°±å°†å®ƒå–ç»™ä½ .å…¶ä¸­ä½ å°±å¯¹åº”ä¸Šé¢æ‰€è¯´çš„ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹,ä½ åªè¦è¯´æ˜ä½ éœ€è¦ä»€ä¹ˆ,å•†åº—è€æ¿åˆ™å¯¹åº”Componentå®ç°ç±»,è´Ÿè´£æ»¡è¶³åˆ«äººçš„éœ€æ±‚,è€Œè¡£æœä¾›åº”å•†åˆ™å¯¹åº”Moduleç±»,ä»–è´Ÿè´£ç”Ÿäº§è¡£æœ.ä¹Ÿè®¸è¿™é‡Œæœ‰ç‚¹ç»•,ä½†ç»è¿‡ä¸‹é¢çš„Demo,ä¹Ÿè®¸èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£.</p><h2 id=ä¹¦å†™demo>ä¹¦å†™Demo</h2><hr><h3 id=å¼•å…¥dagger2>å¼•å…¥Dagger2</h3><p>åœ¨é¡¹ç›®ä¸‹çš„build.gradleæ–‡ä»¶ä¸­æ·»åŠ aptæ’ä»¶:</p><pre><code>buildscript {
    ...
    dependencies {
        classpath 'com.android.tools.build:gradle:2.2.2'

        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
        //æ·»åŠ aptæ’ä»¶
        classpath 'com.neenbedankt.gradle.plugins:android-apt:1.8'
    }
}

...

</code></pre><p>åœ¨appç›®å½•çš„build.gradleæ–‡ä»¶ä¸­æ·»åŠ :</p><pre><code>//åº”ç”¨aptæ’ä»¶
apply plugin: 'com.neenbedankt.android-apt'

...

dependencies {
    ...
    //å¼•å…¥dagger2
    compile 'com.google.daggerğŸ—¡2.4'
    apt 'com.google.dagger:dagger-compiler:2.4'
    //javaæ³¨è§£
    provided 'org.glassfish:javax.annotation:10.0-b28'
}

</code></pre><h3 id=ç¼–å†™å¸ƒæ–™ç±»cloth>ç¼–å†™å¸ƒæ–™ç±»Cloth</h3><p>å†™ä¸€ä¸ªClothç±»ç”¨ä½œä¾èµ–å¯¹è±¡,å®ƒåŒ…å«ä¸€ä¸ªcolorå±æ€§</p><pre><code class=language-java>public class Cloth {
    private String color;

    public String getColor() {
        return color;
    }

    public void setColor(String color) {
        this.color = color;
    }

    @Override
    public String toString() {
        return color + &quot;å¸ƒæ–™&quot;;
    }
}
</code></pre><h3 id=ä¹¦å†™moduleç±»>ä¹¦å†™Moduleç±»</h3><p>ç°åœ¨çš„éœ€æ±‚æ˜¯MainActivityä¸­éœ€è¦ä½¿ç”¨åˆ°Clothå¯¹è±¡,æ‰€ä»¥æˆ‘ä»¬è¦ä¸ºMainActivityä¹¦å†™ä¸€ä¸ªModuleç±»ç”¨æ¥æä¾›Clothå¯¹è±¡,ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæä¾›å•†</p><pre><code class=language-java>@Module
public class MainModule {

    @Provides
    public Cloth getCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
}
</code></pre><p>å—¯?æ€ä¹ˆå¤šäº†ä¸¤ä¸ªæ³¨è§£?è¿™ä¸¤ä¸ªæ³¨è§£æœ‰ä»€ä¹ˆç”¨å‘¢?
æ³¨è§£æ˜¯Dagger2ä¸­çš„å…³é”®,ç¼–å†™Moduleç±»æ—¶è¦åœ¨è¯¥ç±»ä¸Šå£°æ˜<code>@Module</code>ä»¥è¡¨æ˜è¯¥ç±»æ˜¯Moduleç±»,è¿™æ ·Dagger2æ‰èƒ½è¯†åˆ«,é‚£<code>@Provides</code>åˆæ˜¯å¹²å˜›çš„å‘¢?å®ƒçš„ä½œç”¨æ˜¯å£°æ˜Moduleç±»ä¸­å“ªäº›æ–¹æ³•æ˜¯ç”¨æ¥æä¾›ä¾èµ–å¯¹è±¡çš„,å½“Componentç±»éœ€è¦ä¾èµ–å¯¹è±¡æ—¶,ä»–å°±ä¼šæ ¹æ®è¿”å›å€¼çš„ç±»å‹æ¥åœ¨æœ‰<code>@Provides</code>æ³¨è§£çš„æ–¹æ³•ä¸­é€‰æ‹©è°ƒç”¨å“ªä¸ªæ–¹æ³•.åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šå£°æ˜<code>@Provides</code>æ³¨è§£,å°±ç›¸å½“äºåˆ›å»ºäº†ä¸€æ¡ç”Ÿäº§çº¿,è¿™æ¡ç”Ÿäº§çº¿çš„äº§ç‰©å°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼ç±»å‹.æœ‰äº†è¿™æ¡ç”Ÿäº§çº¿,ä¾›åº”å•†å°±èƒ½æä¾›è¿™ç§ç±»å‹çš„å•†å“äº†,å½“å•†åº—è€æ¿å‘ç°æœ‰äººéœ€è¦è¿™ç§ç±»å‹çš„å•†å“æ—¶,ä¾›åº”å•†å°±å¯ä»¥æä¾›ç»™ä»–äº†</p><h3 id=ä¹¦å†™componentæ¥å£>ä¹¦å†™Componentæ¥å£</h3><pre><code class=language-java>@Component(modules=MainModule.class)
public interface MainComponent {
    void inject(MainActivity mainActivity);
}
</code></pre><p>å’ŒModuleç±»ä¸€æ ·,Componentç±»ä¹Ÿæ˜¯éœ€è¦æ³¨è§£å£°æ˜çš„,é‚£ä¸ªæ³¨è§£å°±æ˜¯<code>@Component</code>,ä½†æ˜¯<code>@Component</code>æ³¨è§£çš„ä½œç”¨å¯ä¸æ˜¯å•å•ç”¨æ¥å£°æ˜Componentç±»,ä»–è¿˜æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½,<code>@Component</code>æ³¨è§£æœ‰moduleså’Œdependenciesä¸¤ä¸ªå±æ€§,è¿™ä¸¤ä¸ªå±æ€§çš„ç±»å‹éƒ½æ˜¯Classæ•°ç»„,modulesçš„ä½œç”¨å°±æ˜¯å£°æ˜è¯¥Componentå«æœ‰å“ªå‡ ä¸ªModule,å½“Componentéœ€è¦æŸä¸ªä¾èµ–å¯¹è±¡æ—¶,å°±ä¼šé€šè¿‡è¿™äº›Moduleç±»ä¸­å¯¹åº”çš„æ–¹æ³•è·å–ä¾èµ–å¯¹è±¡,MainComponentä¸­åªåŒ…å«MainModule,æ‰€ä»¥ä»¤modules=MainModule.class,ç›¸å½“äºä¾›åº”å•†å’Œå•†åº—è€æ¿ç¡®å®šåˆä½œå…³ç³»çš„åˆåŒ.è€Œdependencieså±æ€§åˆ™æ˜¯å£°æ˜Componentç±»çš„ä¾èµ–å…³ç³»,è¿™ä¸ªä¸‹é¢å†è¯¦è®².
æ¥å£ä¸­é‚£ä¸ªæ–¹æ³•åˆæ˜¯å¹²å˜›ç”¨çš„å‘¢?
æˆ‘ä»¬ç°åœ¨åªæ˜¯å£°æ˜äº†Componentç±»,ä½†æˆ‘ä»¬è¦æ€ä¹ˆå°†Componentç±»å’Œä¾èµ–éœ€æ±‚æ–¹å¯¹è±¡è”åˆèµ·æ¥å‘¢?ç­”æ¡ˆå°±æ˜¯é€šè¿‡è¿™ä¸ªinjectæ–¹æ³•,è¿™ä¸ªæ–¹æ³•å¯ä»¥å°†ä¾èµ–éœ€æ±‚æ–¹å¯¹è±¡é€åˆ°Componentç±»ä¸­,Componentç±»å°±ä¼šæ ¹æ®ä¾èµ–éœ€æ±‚æ–¹å¯¹è±¡ä¸­å£°æ˜çš„ä¾èµ–å…³ç³»æ¥æ³¨å…¥ä¾èµ–éœ€æ±‚æ–¹å¯¹è±¡ä¸­æ‰€éœ€è¦çš„å¯¹è±¡,æœ¬Demoä¸­MainActivityä¸­éœ€è¦Clothå¯¹è±¡,æ‰€ä»¥æˆ‘ä»¬é€šè¿‡injectæ–¹æ³•å°†MainActivityå®ä¾‹ä¼ å…¥åˆ°MainComponentä¸­,MainComponentå°±ä¼šä»MainModuleä¸­çš„getClothæ–¹æ³•è·å–Clothå®ä¾‹,å¹¶å°†è¯¥å®ä¾‹èµ‹å€¼ç»™MainActivityä¸­çš„clothå­—æ®µ.ç›¸å½“äºä½ å»å•†åº—çš„é“è·¯,æ²¡æœ‰è¿™æ¡è·¯,ä½ å°±æ— æ³•å»å•†åº—å’Œè€æ¿è¯´æ˜ä½ æ‰€éœ€è¦çš„ä¸œè¥¿.<strong>ä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯,injectæ–¹æ³•çš„å‚æ•°ä¸èƒ½ç”¨çˆ¶ç±»æ¥æ¥æ”¶,ä¾‹å¦‚æœ¬Demoä¸­,å¦‚æœinjectçš„å‚æ•°æ˜¯Activity,é‚£ä¹ˆDagger2å°±ä¼šæŠ¥é”™.</strong></p><h3 id=åœ¨mainactivityä¸­å£°æ˜>åœ¨MainActivityä¸­å£°æ˜</h3><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    private TextView tv;
    @Inject
    Cloth cloth;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = (TextView) findViewById(R.id.tv);

        MainComponent build = DaggerMainComponent.builder().mainModule(new MainModule()).build();
        build.inject(this);
        tv.setText(&quot;æˆ‘ç°åœ¨æœ‰&quot; + cloth);
    }
}
</code></pre><p>ä¸Šé¢ä»£ç ä¸­æœ‰ä¸¤å¤„å…³é”®:</p><ol><li>å£°æ˜ä¾èµ–å¯¹è±¡Cloth,å°±æ˜¯åœ¨clothå­—æ®µä¸Šæ·»åŠ <code>@Inject</code>æ³¨è§£,Dagger2ä¸­å£°æ˜ä¾èµ–å¯¹è±¡éƒ½æ˜¯é€šè¿‡<code>@Inject</code>æ³¨è§£,<strong>ä½†æ˜¯<code>@Inject</code>æ³¨è§£çš„å­—æ®µä¸èƒ½æ˜¯privateå’Œprotectedçš„.</strong></li><li>é€šè¿‡Dagger2è‡ªåŠ¨ç”Ÿæˆçš„ç±»æ¥åˆ›å»ºComponentçš„å®ç°ç±»,åˆ›å»ºæ—¶éœ€è¦ä¼ å…¥è¯¥Componentå®ç°ç±»æ‰€éœ€è¦çš„Moduleç±»å®ä¾‹,ä¼ å…¥æ–¹æ³•å°±æ˜¯è°ƒç”¨Moduleç±»ç±»åé¦–å­—æ¯å°å†™å¯¹åº”çš„æ–¹æ³•.è¿™é‡Œæˆ‘ä»¬é€šè¿‡Dagger2è‡ªåŠ¨ç”Ÿæˆçš„DaggerMainComponentç±»åˆ›å»ºäº†MainComponentçš„å®ä¾‹,ç›¸å½“äºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå®å®åœ¨åœ¨çš„å•†åº—,ä¸å†æ˜¯ç†è®ºä¸Šçš„å•†åº—,ä½†æ˜¯åˆ›å»ºå•†åº—ä¸€å®šä¹Ÿè¦åˆ›å»ºçœŸå®çš„ä¾›åº”å•†å˜›,æ‰€ä»¥åˆ›å»ºComponentå®ç°ç±»æ—¶ä¸€å®šè¦ä¼ å…¥Moduleçš„å®ä¾‹.(æ³¨æ„ç¼–å†™å®ŒComponentæ¥å£åDagger2å¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ç±»,éœ€è¦æˆ‘ä»¬ç‚¹å‡»Android Studioä¸­bulidèœå•ä¸‹çš„Rebulid Pojecté€‰é¡¹,æˆ–è€…ç›´æ¥ä¹¦å†™ä»£ç ,ç¼–è¯‘æ—¶Dagger2å°±ä¼šå¸®ä½ è‡ªåŠ¨ç”Ÿæˆ).
å†å°†MainActivityé€šè¿‡injectæ–¹æ³•å‘é€åˆ°MainComponentä¸­,è°ƒç”¨å®Œinjectæ–¹æ³•å,ä½ å°±ä¼šå‘ç°,MainActivityä¸­çš„clothå­—æ®µå·²ç»è¢«èµ‹å€¼,è€Œä¸”è¯¥clothå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬åœ¨MainModuleç±»getClothæ–¹æ³•ä¸­åˆ›å»ºçš„Clothå¯¹è±¡.</li></ol><h3 id=ç»“æœ>ç»“æœ</h3><p><img src=https://img.imgdb.cn/item/605c1a4d8322e6675c774e14.jpg alt=dagger2demo_1.jpeg></p><h2 id=å¦ä¸€ç§æ–¹æ³•>å¦ä¸€ç§æ–¹æ³•</h2><p>å‰é¢çš„Demoå¯èƒ½ç»™äººæœ€å¤§çš„æ„Ÿå—å°±æ˜¯éº»çƒ¦å§?å°±æ˜¯ä¸ºclothèµ‹ä¸ªå€¼,åˆè¦å†™ä»€ä¹ˆModuleç±»,åˆæ˜¯è¦å†™ä»€ä¹ˆComponentæ¥å£.å…¶å®Dagger2è¿˜å¯ä»¥ç”¨æ³¨è§£æ¥æä¾›ä¾èµ–å¯¹è±¡.è®©æˆ‘ä»¬æ¥ç§ç§æ€ä¹ˆä½¿ç”¨.</p><h3 id=åˆ›å»ºä¾èµ–ç±»shoe>åˆ›å»ºä¾èµ–ç±»Shoe</h3><p>æˆ‘ä»¬åˆåˆ›å»ºä¸€ä¸ªä¾èµ–ç±»Shoe</p><pre><code class=language-java>public class Shoe {
    @Inject
    public Shoe() {
    }

    @Override
    public String toString() {
        return &quot;é‹å­&quot;;
    }
}
</code></pre><p>ä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬åˆ›å»ºçš„æ–¹å¼å’ŒClothä¸ä¸€æ ·äº†,æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸Šå£°æ˜äº†<code>@Inject</code>æ³¨è§£,è¿™ä¸ªæ³¨è§£æœ‰ä»€ä¹ˆç”¨å‘¢?ä½œç”¨å¯å¤§äº†,å½“Componentåœ¨æ‰€æ‹¥æœ‰çš„Moduleç±»ä¸­æ‰¾ä¸åˆ°ä¾èµ–éœ€æ±‚æ–¹éœ€è¦ç±»å‹çš„æä¾›æ–¹æ³•æ—¶,Dagger2å°±ä¼šæ£€æŸ¥è¯¥éœ€è¦ç±»å‹çš„æœ‰æ²¡æœ‰ç”¨<code>@Inject</code>å£°æ˜çš„æ„é€ æ–¹æ³•,æœ‰åˆ™ç”¨è¯¥æ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ª.
ç›¸å½“äºä½ å»å•†åº—è´­ä¹°ä¸œè¥¿,ä½ éœ€è¦çš„ä¸œè¥¿å•†åº—çš„ä¾›åº”å•†ä¸ç”Ÿäº§,å•†åº—è€æ¿å°±åªå¥½å¸®ä½ å»ç½‘ä¸Šçœ‹çœ‹æœ‰æ²¡æœ‰ä½ éœ€è¦çš„ä¸œè¥¿,æœ‰åˆ™å¸®ä½ ç½‘è´­ä¸€ä¸ª.(å‡è®¾ä½ ä¸ä¼šç½‘è´­,å“ˆå“ˆ^ ^).</p><h3 id=åœ¨mainactivityä¸­å£°æ˜shoeä¾èµ–>åœ¨MainActivityä¸­å£°æ˜Shoeä¾èµ–</h3><p>æˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„MainActivity,æ·»åŠ ä¸€ç‚¹ä¸œè¥¿</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
	...
    @Inject
    Shoe shoe;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
      	...
        tv.setText(&quot;æˆ‘ç°åœ¨æœ‰&quot; + cloth + &quot;å’Œ&quot; + shoe);
    }
}
</code></pre><h3 id=ç»“æœ-1>ç»“æœ</h3><p><img src=https://img.imgdb.cn/item/605c1a648322e6675c77592a.jpg alt=dagger2demo_2.jpeg></p><h3 id=æ³¨æ„>æ³¨æ„</h3><p>æœ‰äº›è¯»è€…å¯èƒ½ä¼šè¿™æ ·æƒ³:ä¸ºä»€ä¹ˆä¸éƒ½ç”¨è¿™ç§æ–¹æ³•æ¥å£°æ˜å‘¢?ä¸ºä»€ä¹ˆè¦ç”¨Moduleç±»?
ç­”æ¡ˆæ˜¯è¿™æ ·çš„,é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šç”¨åˆ°åˆ«äººçš„jaråŒ…,æˆ‘ä»¬æ— æ³•ä¿®æ”¹åˆ«äººçš„æºç ,å°±æ›´åˆ«è¯´åœ¨äººå®¶çš„ç±»ä¸Šæ·»åŠ æ³¨è§£äº†,æ‰€ä»¥æˆ‘ä»¬åªèƒ½é€šè¿‡Moduleç±»æ¥æä¾›.</p><h2 id=å¤æ‚ä¸€ç‚¹çš„æƒ…å†µ>å¤æ‚ä¸€ç‚¹çš„æƒ…å†µ</h2><p>æˆ‘ä»¬åˆ›å»ºçš„è¿™äº›ä¾èµ–ç±»éƒ½ä¸ç”¨ä¾èµ–äºå…¶å®ƒä¾èµ–ç±»,ä½†æ˜¯å¦‚æœéœ€è¦ä¾èµ–äºå…¶å®ƒä¾èµ–ç±»åˆè¦æ€ä¹ˆå¼„å‘¢?</p><h3 id=åˆ›å»ºä¾èµ–ç±»clothes>åˆ›å»ºä¾èµ–ç±»Clothes</h3><p>æˆ‘ä»¬åˆæ¥åˆ›å»ºä¸€ä¸ªè¡£æœç±»Clothes,åˆ¶ä½œè¡£æœæ—¶éœ€è¦å¸ƒæ–™,æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºClothesçš„å®ä¾‹æ—¶éœ€è¦ç”¨åˆ°Clothå®ä¾‹</p><pre><code class=language-java>public class Clothes {
    private Cloth cloth;

    public Clothes(Cloth cloth) {
        this.cloth = cloth;
    }

    public Cloth getCloth() {
        return cloth;
    }

    @Override
    public String toString() {
        return cloth.getColor() + &quot;è¡£æœ&quot;;
    }

}
</code></pre><h3 id=åœ¨moduleç±»ä¸­å¢åŠ æä¾›æ–¹æ³•>åœ¨Moduleç±»ä¸­å¢åŠ æä¾›æ–¹æ³•</h3><p>ç°åœ¨æˆ‘ä»¬çš„MainActivityä¸­éœ€è¦ä¾èµ–äºClotheså¯¹è±¡,æ‰€ä»¥æˆ‘ä»¬åœ¨MianModuleä¸­æ·»åŠ æä¾›Clotheså¯¹è±¡çš„æ–¹æ³•,ä½†æ˜¯Clotheséœ€è¦ä¾èµ–äºClothå¯¹è±¡,è¿™è¦æ€ä¹ˆåŠå‘¢?å¯èƒ½æœ€å…ˆæƒ³åˆ°çš„åŠæ³•å°±æ˜¯è¿™æ ·:</p><pre><code class=language-java>	@Provides
    public Clothes getClothes(){
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return new Clothes(cloth);
    }
</code></pre><p>ç›´æ¥åœ¨æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªClothä¸å°±å¾—äº†,ä½†æ˜¯ä½ æœ‰æ²¡æœ‰å‘ç°,åˆ›å»ºClothçš„ä»£ç å·²ç»åœ¨getClothæ–¹æ³•ä¸­æœ‰äº†,æˆ‘ä»¬èƒ½ä¸èƒ½ç”¨getClothæ–¹æ³•ä¸­åˆ›å»ºçš„Clothå®ä¾‹æ¥åˆ›å»ºClotheså®ä¾‹å‘¢?
Dagger2æä¾›äº†è¿™æ ·çš„åŠŸèƒ½,æˆ‘ä»¬åªè¦åœ¨getClothesæ–¹æ³•ä¸­æ·»åŠ Clothå‚æ•°,Dagger2å°±ä¼šåƒå¸®ä¾èµ–éœ€æ±‚æ–¹æ‰¾ä¾èµ–å¯¹è±¡ä¸€æ ·å¸®ä½ æ‰¾åˆ°è¯¥æ–¹æ³•ä¾èµ–çš„Clothå®ä¾‹,æ‰€ä»¥æˆ‘ä»¬ä»£ç å¯ä»¥è¿™æ ·æ”¹:</p><pre><code class=language-java>	@Provides
    public Clothes getClothes(Cloth cloth){
        return new Clothes(cloth);
    }
</code></pre><h3 id=åœ¨mainactivityä¸­å£°æ˜clothesä¾èµ–>åœ¨MainActivityä¸­å£°æ˜Clothesä¾èµ–</h3><p>æˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„MainActivity,æ·»åŠ ä¸€ç‚¹ä¸œè¥¿</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    ...
    @Inject
    Clothes clothes;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        tv.setText(&quot;æˆ‘ç°åœ¨æœ‰&quot; + cloth + &quot;å’Œ&quot; + shoe + &quot;å’Œ&quot; + clothes);
    }
}
</code></pre><h3 id=ç»“æœ-2>ç»“æœ</h3><p><img src=https://img.imgdb.cn/item/605c1a748322e6675c775f6d.jpg alt=dagger2demo_3.jpeg></p><h2 id=ä¾èµ–æ€»ç»“>ä¾èµ–æ€»ç»“</h2><p>åŒç†,åœ¨å¸¦æœ‰<code>@Inject</code>æ³¨è§£çš„æ„é€ å‡½æ•°è¦æ˜¯ä¾èµ–äºå…¶å®ƒå¯¹è±¡,Dagger2ä¹Ÿä¼šå¸®ä½ è‡ªåŠ¨æ³¨å…¥.ç¬”è€…å°±ä¸æµ‹è¯•äº†,å¸Œæœ›è¯»è€…äº²æµ‹ä¸€ä¸‹.
è¿™é‡Œæˆ‘ä»¬å¼•ç”¨<a href="https://dreamerhome.github.io/2016/07/07/dagger/?utm_source=tuicool&utm_medium=referral">ä¾èµ–æ³¨å…¥ç¥å™¨ï¼šDagger2è¯¦è§£ç³»åˆ—</a>ä¸­çš„ä¸€æ®µè¯:</p><blockquote><p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æä¾›ä¾èµ–ï¼Œä¸€ä¸ªæ˜¯æ³¨è§£äº†@Injectçš„æ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åœ¨Moduleé‡Œæä¾›çš„ä¾èµ–ï¼Œé‚£ä¹ˆDagger2æ˜¯æ€ä¹ˆé€‰æ‹©ä¾èµ–æä¾›çš„å‘¢ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼š</p></blockquote><ul><li>æ­¥éª¤1ï¼šæŸ¥æ‰¾Moduleä¸­æ˜¯å¦å­˜åœ¨åˆ›å»ºè¯¥ç±»çš„æ–¹æ³•ã€‚</li><li>æ­¥éª¤2ï¼šè‹¥å­˜åœ¨åˆ›å»ºç±»æ–¹æ³•ï¼ŒæŸ¥çœ‹è¯¥æ–¹æ³•æ˜¯å¦å­˜åœ¨å‚æ•°</li><li>æ­¥éª¤2.1ï¼šè‹¥å­˜åœ¨å‚æ•°ï¼Œåˆ™æŒ‰ä»æ­¥éª¤1å¼€å§‹ä¾æ¬¡åˆå§‹åŒ–æ¯ä¸ªå‚æ•°</li><li>æ­¥éª¤2.2ï¼šè‹¥ä¸å­˜åœ¨å‚æ•°ï¼Œåˆ™ç›´æ¥åˆå§‹åŒ–è¯¥ç±»å®ä¾‹ï¼Œä¸€æ¬¡ä¾èµ–æ³¨å…¥åˆ°æ­¤ç»“æŸ</li><li>æ­¥éª¤3ï¼šè‹¥ä¸å­˜åœ¨åˆ›å»ºç±»æ–¹æ³•ï¼Œåˆ™æŸ¥æ‰¾Injectæ³¨è§£çš„æ„é€ å‡½æ•°ï¼Œçœ‹æ„é€ å‡½æ•°æ˜¯å¦å­˜åœ¨å‚æ•°</li><li>æ­¥éª¤3.1ï¼šè‹¥å­˜åœ¨å‚æ•°ï¼Œåˆ™ä»æ­¥éª¤1å¼€å§‹ä¾æ¬¡åˆå§‹åŒ–æ¯ä¸ªå‚æ•°</li><li>æ­¥éª¤3.2ï¼šè‹¥ä¸å­˜åœ¨å‚æ•°ï¼Œåˆ™ç›´æ¥åˆå§‹åŒ–è¯¥ç±»å®ä¾‹ï¼Œä¸€æ¬¡ä¾èµ–æ³¨å…¥åˆ°æ­¤ç»“æŸ</li></ul><p>ä¹Ÿå°±è¯´Dagger2ä¼šé€’å½’çš„æä¾›ä¾èµ–.</p><h2 id=namedå’Œqulifieræ³¨è§£çš„ä½¿ç”¨>@Namedå’Œ@Qulifieræ³¨è§£çš„ä½¿ç”¨</h2><h3 id=named>@Named</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨åˆæœ‰äº†æ–°çš„éœ€æ±‚,MainActivityä¸­éœ€è¦ä¸¤ç§å¸ƒæ–™,åˆ†åˆ«æ˜¯çº¢å¸ƒæ–™å’Œè“å¸ƒæ–™,ä½†æˆ‘ä»¬çš„MainModuleç±»ä¸­åªèƒ½æä¾›çº¢å¸ƒæ–™,æ€ä¹ˆåŠå‘¢?
è¯»è€…å¯èƒ½ä¼šæƒ³:åœ¨MainModuleç±»ä¸­å†æ·»åŠ ä¸€ä¸ªæä¾›è“å¸ƒæ–™çš„æ–¹æ³•ä¸å°±è¡Œäº†:</p><pre><code class=language-java>	@Provides
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
    @Provides
    public Cloth getBlueCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;è“è‰²&quot;);
        return cloth;
    }
</code></pre><p>å¯é—®é¢˜å°±æ¥äº†,Dagger2æ˜¯é€šè¿‡è¿”å›å€¼ç±»å‹æ¥ç¡®å®šçš„,å½“ä½ éœ€è¦çº¢å¸ƒæ–™æ—¶,å®ƒåˆæ€ä¹ˆçŸ¥é“å“ªä¸ªæ˜¯çº¢å¸ƒæ–™å‘¢?æ‰€ä»¥Dagger2ä¸ºæˆ‘ä»¬æä¾›<code>@Named</code>æ³¨è§£,å®ƒæ€ä¹ˆä½¿ç”¨å‘¢?å®ƒæœ‰ä¸€ä¸ªvalueå€¼,ç”¨æ¥æ ‡è¯†è¿™ä¸ªæ–¹æ³•æ˜¯ç»™è°ç”¨çš„.ä¿®æ”¹æˆ‘ä»¬çš„ä»£ç :</p><pre><code class=language-java>    @Provides
    @Named(&quot;red&quot;)
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
    @Provides
    @Named(&quot;blue&quot;)
    public Cloth getBlueCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;è“è‰²&quot;);
        return cloth;
    }
</code></pre><p>æˆ‘ä»¬åœ¨getRedClothæ–¹æ³•ä¸Šä½¿ç”¨<code>@Named("red")</code>è¡¨æ˜æ­¤æ–¹æ³•è¿”å›çš„æ˜¯çº¢å¸ƒæ–™,åŒç†,åœ¨getBlueClothæ–¹æ³•ä¸Šä½¿ç”¨<code>@Named("blue")</code>è¡¨æ˜æ­¤æ–¹æ³•è¿”å›çš„æ˜¯è“å¸ƒæ–™,æ¥ä¸‹æˆ‘ä»¬åªè¦åœ¨MainActivityä¸­çš„å¸ƒæ–™å­—æ®µä¸ŠåŒæ ·ä½¿ç”¨<code>@Named</code>æ³¨è§£,å°±å¯ä»¥ä¸€ä¸€é…å¯¹äº†.</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    ...
    @Inject
    @Named(&quot;red&quot;)
    Cloth redCloth;
    @Inject
    @Named(&quot;blue&quot;)
    Cloth blueCloth;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        tv.setText(&quot;æˆ‘ç°åœ¨æœ‰&quot; + redCloth + &quot;å’Œ&quot; + blueCloth );
    }
}
</code></pre><p>åœ¨<code>redCloth</code>ä¸Šç”¨<code>@Named("red")</code>æ ‡è®°å,ä»–å°±ä¼šå¯¹åº”Moduleä¸­å¯¹åº”çš„æ–¹æ³•.</p><h3 id=ç»“æœ-3>ç»“æœ</h3><p><img src=https://img.imgdb.cn/item/605c1a918322e6675c776ce4.jpg alt=dagger2demo_4.png></p><h3 id=qulifier>@Qulifier</h3><p><code>@Qulifier</code>åŠŸèƒ½å’Œ<code>@Named</code>ä¸€æ ·,å¹¶ä¸”<code>@Named</code>å°±æ˜¯ç»§æ‰¿<code>@Qulifier</code>çš„,æˆ‘ä»¬è¦æ€ä¹ˆä½¿ç”¨<code>@Qulifier</code>æ³¨è§£å‘¢?ç­”æ¡ˆå°±æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£:</p><pre><code class=language-java>@Qualifier
@Retention(RetentionPolicy.RUNTIME)
public @interface RedCloth {
}
</code></pre><p>æœ‰äº†è¿™ä¸ªæ³¨è§£,æˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒåœ¨æ›¿æ¢æ‰ä¸Šé¢çš„<code>@Named("red")</code>,æ•ˆæœæ˜¯ä¸€æ ·çš„.è¯»è€…å¯ä»¥äº²è‡ªè¯•ä¸€è¯•.
è€Œä¸”è¿™ä¸¤ä¸ªæ³¨è§£è¿˜èƒ½ä½¿ç”¨åœ¨ä¾èµ–å‚æ•°ä¸Š,æ¯”å¦‚è¿™ä¸ª:</p><pre><code class=language-java>	@Provides
    public Clothes getClothes(@Named(&quot;blue&quot;) Cloth cloth){
        return new Clothes(cloth);
    }
</code></pre><p>æ•ˆæœå’Œä¸Šé¢è¯´æ˜çš„ä¸€æ ·,è¿›å…¥è¿™ä¸ªæ–¹æ³•çš„clothç”±ä¸Šé¢æœ‰<code>@Named("blue")</code>çš„æ–¹æ³•æä¾›</p><h2 id=singletonå’Œscopeçš„ä½¿ç”¨>@Singletonå’Œ@Scopeçš„ä½¿ç”¨</h2><h3 id=singleton>@Singleton</h3><p>å‡è®¾ç°åœ¨MainActivityä¸­éœ€è¦ä¾èµ–Clotheså’ŒCloth,æˆ‘ä»¬åœ¨MainModuleä¸­æä¾›è¿™ä¸¤ä¸ªç±»çš„æä¾›æ–¹æ³•:</p><pre><code class=language-java>@Module
public class MainModule {

    @Provides
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
    
    @Provides
    public Clothes getClothes(Cloth cloth){
        return new Clothes(cloth);
    }
}
</code></pre><p>æ¥ç€åœ¨MainActivityä¸­å£°æ˜:</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    private TextView tv;
    @Inject
    Cloth redCloth;

    @Inject
    Clothes clothes;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = (TextView) findViewById(R.id.tv);

        MainComponent build = DaggerMainComponent.builder().mainModule(new MainModule()).build();
        build.inject(this);
        tv.setText(&quot;redCloth=clothesä¸­çš„clothå—?:&quot; + (redCloth == clothes.getCloth()));
    }
}
</code></pre><p>è¿è¡Œç»“æœ:</p><p><img src=https://img.imgdb.cn/item/605c1a9c8322e6675c777385.jpg alt=dagger2demo_5.png></p><p>ä½ ä¼šå‘ç°,MainActivityä¸­çš„Clothå¯¹è±¡å’ŒClothesä¸­çš„Clothå¯¹è±¡å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡,æ³¨å…¥è¿‡ç¨‹ä¸­,å¯¹clothæ³¨å…¥æ—¶ä¼šè°ƒç”¨ä¸€æ¬¡getRedClothæ–¹æ³•,åˆ›å»ºäº†ä¸€ä¸ªClothå¯¹è±¡;æ³¨å…¥Clothesæ—¶åˆä¼šè°ƒç”¨ä¸€æ¬¡getRedClothæ–¹æ³•,è¿™æ—¶åˆä¼šåˆ›å»ºä¸€ä¸ªClothå¯¹è±¡,æ‰€ä»¥æ‰ä¼šå‡ºç°ä¸Šé¢çš„ç»“æœ.ä½†æ˜¯å¦‚æœéœ€è¦MainActivityä¸­çš„Clothå¯¹è±¡å’ŒClothesä¸­çš„Clothå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆè¦æ€ä¹ˆåŠå‘¢?Dagger2ä¸ºæˆ‘ä»¬æä¾›äº†<code>@Singleton</code>æ³¨è§£,å’Œåå­—ä¸€æ ·,è¿™ä¸ªæ³¨è§£çš„ä½œç”¨å°±æ˜¯å£°æ˜å•ä¾‹æ¨¡å¼,æˆ‘ä»¬å…ˆçœ‹çœ‹å®ƒæ€ä¹ˆä½¿ç”¨,ä¸‹é¢å†è®²åŸç†.
é¦–å…ˆ,åœ¨getRedClothæ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£:</p><pre><code class=language-java>	@Singleton
    @Provides
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
</code></pre><p>å†åœ¨MainComponentæ¥å£ä¸Šæ·»åŠ è¯¥æ³¨è§£:</p><pre><code class=language-java>@Singleton
@Component(modules=MainModule.class)
public interface MainComponent {
    void inject(MainActivity mainActivity);
}
</code></pre><p>æˆ‘ä»¬çœ‹çœ‹è¿è¡Œç»“æœ:</p><p><img src=https://img.imgdb.cn/item/605c1aaa8322e6675c7778f7.jpg alt=dagger2demo_6.png></p><p>æœ‰æ²¡æœ‰å‘ç°,MainActivityä¸­çš„Clothå¯¹è±¡å’ŒClothesä¸­çš„Clothå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†,æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡!</p><h3 id=scope>@Scope</h3><p><code>@Singleton</code>æ˜¯æ€ä¹ˆå®ç°çš„å‘¢?æˆ‘ä»¬å…ˆçœ‹çœ‹<code>@Scope</code>æ³¨è§£,å¼„æ‡‚å®ƒ,<code>@Singleton</code>ä½ ä¹Ÿå°±ä¼šæ˜ç™½äº†,ä¸‹é¢æˆ‘ä»¬å°±æ¥åˆ†æåˆ†æ
é¡¾åæ€ä¹‰,<code>@Scope</code>å°±æ˜¯ç”¨æ¥å£°æ˜ä½œç”¨èŒƒå›´çš„.<code>@Scope</code>å’Œ<code>@Qulifier</code>ä¸€æ ·,éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£æ‰èƒ½ä½¿ç”¨,æˆ‘ä»¬å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£:</p><pre><code class=language-java>@Scope
@Retention(RetentionPolicy.RUNTIME)
public @interface PerActivity {
}
</code></pre><p>è¿™ä¸ªæ³¨è§£æœ‰ä»€ä¹ˆç”¨å‘¢?ç­”æ¡ˆå°±æ˜¯å£°æ˜ä½œç”¨èŒƒå›´,å½“æˆ‘ä»¬å°†è¿™ä¸ªæ³¨è§£ä½¿ç”¨åœ¨Moduleç±»ä¸­çš„Provideæ–¹æ³•ä¸Šæ—¶,å°±æ˜¯å£°æ˜è¿™ä¸ªProvideæ–¹æ³•æ˜¯åœ¨PerActivityä½œç”¨èŒƒå›´å†…çš„,å¹¶ä¸”å½“ä¸€ä¸ªComponentè¦å¼•ç”¨è¿™ä¸ªModuleæ—¶,å¿…é¡»ä¹Ÿè¦å£°æ˜è¿™ä¸ªComponentæ˜¯PerActivityä½œç”¨èŒƒå›´å†…çš„,å¦åˆ™å°±ä¼šæŠ¥é”™,å£°æ˜æ–¹æ³•ä¹Ÿå¾ˆç®€å•,å°±æ˜¯åœ¨Componentæ¥å£ä¸Šä½¿ç”¨è¿™ä¸ªæ³¨è§£.ä½†æ˜¯æˆ‘ä»¬å£°æ˜è¿™ä¸ªä½œç”¨èŒƒå›´åˆæœ‰ä»€ä¹ˆç”¨å‘¢?åŸæ¥Dagger2æœ‰è¿™æ ·ä¸€ä¸ªæœºåˆ¶:åœ¨åŒä¸€ä¸ªä½œç”¨èŒƒå›´å†…,Provideæ–¹æ³•æä¾›çš„ä¾èµ–å¯¹è±¡å°±ä¼šå˜æˆå•ä¾‹,ä¹Ÿå°±æ˜¯è¯´ä¾èµ–éœ€æ±‚æ–¹ä¸ç®¡ä¾èµ–å‡ æ¬¡Provideæ–¹æ³•æä¾›çš„ä¾èµ–å¯¹è±¡,Dagger2éƒ½åªä¼šè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•.å°±å’Œä¸Šé¢é‚£ä¸ªä¾‹å­ä¸€æ ·,æ­£å¸¸æƒ…å†µä¸‹,åœ¨æ³¨å…¥MainActivityä¸­çš„Clothå¯¹è±¡æ—¶ä¼šè°ƒç”¨ä¸€æ¬¡getRedClothæ–¹æ³•,æ³¨å…¥Clotheså¯¹è±¡æ—¶å› ä¸ºä¾èµ–Clothå¯¹è±¡,æ‰€ä»¥åˆä¼šè°ƒç”¨ä¸€æ¬¡getRedClothæ–¹æ³•,å¯¼è‡´è¿™ä¸¤ä¸ªClothå¯¹è±¡å¹¶ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹.ä½†æ˜¯æˆ‘ä»¬ç»™å®ƒå£°æ˜ä½œç”¨èŒƒå›´å,è¿™ä¸¤æ¬¡å¯¹Clothçš„ä¾èµ–åªä¼šè°ƒç”¨ä¸€æ¬¡getRedClothæ–¹æ³•,è¿™æ ·è¿™ä¸¤ä¸ªClothå¯¹è±¡å°±æ˜¯åŒä¸€å®ä¾‹äº†,è¿™æ ·å°±ä¿è¯äº†åœ¨ç»™MainActivityæ³¨å…¥æ—¶,æ‰€æœ‰å£°æ˜çš„Clothä¾èµ–éƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹.(æ³¨æ„:åªæœ‰Moduleç±»ä¸­å£°æ˜äº†ä½œç”¨èŒƒå›´çš„Provideæ–¹æ³•æ‰èƒ½å®ç°å•ä¾‹,æ²¡å£°æ˜çš„æ–¹æ³•å°±ä¸æ˜¯å•ä¾‹çš„)
æŸ¥çœ‹æºç ä½ ä¼šå‘ç°<code>Singleton</code>å…¶å®æ˜¯ç»§æ‰¿<code>@Scope</code>æ³¨è§£çš„,æ‰€ä»¥ä½ çŸ¥é“äº†<code>Singleton</code>æ˜¯æ€ä¹ˆå®ç°å•ä¾‹æ¨¡å¼çš„å§.
å¯èƒ½æœ‰äº›è¯»è€…å¯èƒ½ä¼šé—®,Dagger2æ—¢ç„¶æœ‰äº†<code>Singleton</code>ä¸ºä»€ä¹ˆè¿˜è¦æˆ‘ä»¬è‡ªå®šä¹‰<code>PerActivity</code>æ³¨è§£?è¿™å°±æ¶‰åŠåˆ°ä»£ç å¯è¯»æ€§äº†,å½“ä¾èµ–éœ€æ±‚æ–¹æ˜¯Activityæ—¶,æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>PerActivity</code>æ³¨è§£,å½“ä¾èµ–éœ€æ±‚æ–¹æ˜¯Fragmentæ—¶,æˆ‘ä»¬åˆå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>PerFragment</code>æ³¨è§£,è¿™æ ·æˆ‘ä»¬å°±èƒ½æ¸…æ¥šçš„åŒºåˆ†ä¾èµ–å¯¹è±¡çš„æä¾›ç›®æ ‡äº†
é‚£æˆ‘ä»¬é€šè¿‡æ„é€ å‡½æ•°æä¾›ä¾èµ–çš„æ–¹å¼åˆè¦æ€ä¹ˆå£°æ˜ä½œç”¨èŒƒå›´å‘¢?ç­”æ¡ˆå°±æ˜¯åœ¨ç±»åä¸Šä½¿ç”¨æ³¨è§£æ ‡æ˜,<strong>åˆ‡è®°ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸Šç”¨æ³¨è§£æ ‡æ˜,è¿™æ ·æ˜¯æ— æ•ˆçš„</strong>.
è¯»è€…å¯ä»¥è¯•è¯•ç”¨<code>PerActivity</code>æ³¨è§£ä»£æ›¿ä¸Šé¢ä¾‹å­ä¸­çš„<code>Singleton</code>æ³¨è§£,ä½ ä¼šå‘ç°æ•ˆæœæ˜¯ä¸€æ ·çš„</p><blockquote><p><strong>æ³¨æ„æ³¨æ„æ³¨æ„</strong>:å•ä¾‹æ˜¯åœ¨åŒä¸€ä¸ªComponentå®ä¾‹æä¾›ä¾èµ–çš„å‰æä¸‹æ‰æœ‰æ•ˆçš„,ä¸åŒçš„Componentå®ä¾‹åªèƒ½é€šè¿‡Componentä¾èµ–æ‰èƒ½å®ç°å•ä¾‹.ä¹Ÿå°±æ˜¯è¯´,ä½ è™½ç„¶åœ¨ä¸¤ä¸ªComponentæ¥å£ä¸Šéƒ½æ·»åŠ äº†<code>PerActivity</code>æ³¨è§£,ä½†æ˜¯è¿™ä¸¤ä¸ªComponentæä¾›ä¾èµ–æ—¶æ˜¯æ²¡æœ‰è”ç³»çš„,ä»–ä»¬åªèƒ½åœ¨å„è‡ªçš„èŒƒå›´å†…å®ç°å•ä¾‹.(ä¸‹ä¸€ä¸ªä¾‹å­ä¼šä½“ç°åˆ°)</p></blockquote><h2 id=ç»„ä»¶ä¾èµ–dependenciesçš„ä½¿ç”¨>ç»„ä»¶ä¾èµ–dependenciesçš„ä½¿ç”¨</h2><p>åœ¨å®é™…å¼€å‘ä¸­,æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°å·¥å…·ç±»,å·¥å…·ç±»ä¸€èˆ¬åœ¨æ•´ä¸ªAppçš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯å•ä¾‹çš„,æˆ‘ä»¬ç°åœ¨ç»™æˆ‘ä»¬çš„Demoæ·»åŠ ä¸€ä¸ªå·¥å…·ç±»ClothHandler:</p><pre><code class=language-java>public class ClothHandler {
    public Clothes handle(Cloth cloth){
        return new Clothes(cloth);
    }
}
</code></pre><p>å®ƒçš„åŠŸèƒ½å°±æ˜¯å°†clothåŠ å·¥æˆclothes,å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªActivityä¸­éƒ½è¦ä½¿ç”¨è¯¥å·¥å…·ç±»,æˆ‘ä»¬è¦æ€ä¹ˆä½¿ç”¨Dagger2å¸®æˆ‘ä»¬æ³¨å…¥å‘¢?
æˆ‘ä»¬å…ˆç”¨ä¸Šé¢æ‰€å­¦çš„æ–¹æ³•è¯•è¯•,å…ˆåœ¨MainModuleä¸­æ·»åŠ æä¾›æ–¹æ³•:</p><pre><code class=language-java>@Module
public class MainModule {

    @PerActivity
    @Provides
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
    
    @PerActivity
    @Provides
    public ClothHandler getClothHandler(){
        return new ClothHandler();
    }
}
</code></pre><p>å†åœ¨MainActivityä¸­å£°æ˜ä¾èµ–:</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    private TextView tv;
    @Inject
    Cloth redCloth;

    @Inject
    ClothHandler clothHandler;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = (TextView) findViewById(R.id.tv);

        MainComponent build = DaggerMainComponent.builder().mainModule(new MainModule()).build();
        build.inject(this);
        tv.setText(&quot;çº¢å¸ƒæ–™åŠ å·¥åå˜æˆäº†&quot; + clothHandler.handle(redCloth) + &quot;\nclothHandleråœ°å€:&quot; + clothHandler);
    }
	//åœ¨å¸ƒå±€æ–‡ä»¶ä¸­å£°æ˜çš„ç‚¹å‡»æ–¹æ³•
    public void onClick(View v){
        Intent intent = new Intent(this,SecondActivity.class);
        startActivity(intent);
    }
}
</code></pre><p>åŒç†åœ¨ä¹¦å†™ç¬¬äºŒä¸ªActivity,å¹¶ä¸ºå®ƒä¹¦å†™Moduleç±»Componentæ¥å£:</p><pre><code class=language-java>public class SecondActivity extends AppCompatActivity {
    private TextView tv;

    @Inject
    Cloth blueCloth;
    @Inject
    ClothHandler clothHandler;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_second);
        tv = (TextView) findViewById(R.id.tv);
        SecondComponent component = DaggerSecondComponent.builder().secondModule(new SecondModule()).build();
        component.inject(this);
        tv.setText(&quot;è“å¸ƒæ–™åŠ å·¥åå˜æˆäº†&quot; + clothHandler.handle(blueCloth) + &quot;\nclothHandleråœ°å€:&quot; + clothHandler);
    }
}

@Module
public class SecondModule {

    @PerActivity
    @Provides
    public Cloth getBlueCloth(){
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;è“è‰²&quot;);
        return cloth;
    }

    @PerActivity
    @Provides
    public ClothHandler getClothHandler(){
        return new ClothHandler();
    }
}

@PerActivity
@Component(modules = SecondModule.class)
public interface SecondComponent {
    void inject(SecondActivity secondActivity);
}

</code></pre><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç»“æœ:</p><p><img src=https://img.imgdb.cn/item/605c1ac48322e6675c7784d9.jpg alt=dagger2demo_7.png></p><p>ä½ ä¼šå‘ç°,è™½ç„¶æˆ‘ä»¬æˆåŠŸçš„å°†ClothHandleræ³¨å…¥åˆ°äº†è¿™ä¸¤ä¸ªActivityä¸­,ä½†æ˜¯ä½ ä¼šå‘ç°,è¿™ä¸¤ä¸ªActivityä¸­çš„ClothHandlerå®ä¾‹ä¸æ˜¯ä¸€æ ·çš„(éªŒè¯äº†ä¸Šé¢é‚£ä¸ªç»“è®º),å¹¶ä¸”æˆ‘ä»¬å‘ç°è¿™ç§æ³¨å…¥æ–¹å¼è¦åœ¨æ¯ä¸€ä¸ªModuleä¸­éƒ½è¦æä¾›getClothHandleræ–¹æ³•, å‡å¦‚æœ‰20ä¸ªActivityéƒ½éœ€è¦ç”¨åˆ°ClothHandler,é‚£æˆ‘ä»¬éƒ½è¿™æ ·å†™,ä¸å°±ä»£ç é‡å¤äº†å—.å¹¶ä¸”æˆ‘ä»¬è¿˜è¦å®ç°å•ä¾‹,æ€ä¹ˆåŠå‘¢?Dagger2å¾ˆè´´å¿ƒçš„ä¸ºæˆ‘ä»¬æä¾›äº†Componentä¾èµ–,å°±èƒ½å®Œç¾çš„è§£å†³è¿™ä¸ªé—®é¢˜.
åœ¨é¢å‘å¯¹è±¡çš„æ€æƒ³ä¸­,æˆ‘ä»¬ç¢°åˆ°è¿™ç§æƒ…å†µä¸€èˆ¬éƒ½è¦æŠ½å–çˆ¶ç±»,Dagger2ä¹Ÿæ˜¯ç”¨çš„è¿™ç§æ€æƒ³,æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªBaseModule,ç”¨æ¥æä¾›å·¥å…·ç±»:</p><pre><code class=language-java>@Module
public class BaseModule {
	
    @Singleton //å•ä¾‹
    @Provides
    public ClothHandler getClothHandler(){
        return new ClothHandler();
    }
}
</code></pre><p>åœ¨åˆ›å»ºä¸€ä¸ªBaseComponentæ¥å£:</p><pre><code class=language-java>
@Singleton //å¯¹åº”Moduleä¸­å£°æ˜çš„å•ä¾‹
@Component(modules = BaseModule.class)
public interface BaseComponent {
    ClothHandler getClothHandler();
}
</code></pre><p>å—¯?è¿™ä¸ªComponentæ€ä¹ˆæœ‰ç‚¹ä¸ä¸€æ ·,æ€ä¹ˆæ²¡æœ‰injectæ–¹æ³•å‘¢?ä¸Šé¢è®²è¿‡,æˆ‘ä»¬é€šè¿‡injectæ–¹æ³•ä¾èµ–éœ€æ±‚æ–¹å®ä¾‹é€åˆ°Componentä¸­,ä»è€Œå¸®åŠ©ä¾èµ–éœ€æ±‚æ–¹å®ç°ä¾èµ–,ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªBaseComponentæ˜¯ç»™å…¶ä»–Componentæä¾›ä¾èµ–çš„,æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨injectæ–¹æ³•,ä½†æ˜¯BaseComponentä¸­å¤šäº†ä¸€ä¸ªgetClothHandleræ–¹æ³•,å®ƒçš„è¿”å›å€¼æ˜¯ClothHandlerå¯¹è±¡,è¿™ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆç”¨å‘¢?å®ƒçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ä¾èµ–äºBaseComponentçš„Component,BaseComponentèƒ½ä¸ºä½ ä»¬æä¾›ClothHandlerå¯¹è±¡,å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–¹æ³•,BaseComponentå°±ä¸èƒ½æä¾›ClothHandlerå¯¹è±¡(è¿™ä¸ªæä¾›è§„åˆ™å’Œä¸Šé¢çš„ä¾èµ–è§„åˆ™ç›¸åŒ,å¯ä»¥å®ç°å•ä¾‹).æ—¢ç„¶æœ‰äº†BaseComponent,é‚£æˆ‘ä»¬å°±å¯åœ¨å…¶å®ƒComponentä¸­ä¾èµ–å®ƒäº†.æˆ‘ä»¬åˆ é™¤MainModuleå’ŒSecondModuleä¸­çš„getClothHandleræ–¹æ³•:</p><pre><code class=language-java>@Module
public class MainModule {

    @PerActivity
    @Provides
    public Cloth getRedCloth() {
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }

}
@Module
public class SecondModule {

    @PerActivity
    @Provides
    public Cloth getBlueCloth(){
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;è“è‰²&quot;);
        return cloth;
    }

}
</code></pre><p>æ¥ä¸‹æ¥åœ¨MainComponentå’ŒSecondComponentä¸­å£°æ˜ä¾èµ–,å°±è¦ç”¨åˆ°<code>@Component</code>ä¸­çš„<code>dependencies</code>å±æ€§äº†:</p><pre><code class=language-java>@PerActivity
@Component(modules=MainModule.class,dependencies = BaseComponent.class)
public interface MainComponent {
    void inject(MainActivity mainActivity);
}

@PerActivity
@Component(modules = SecondModule.class,dependencies = BaseComponent.class)
public interface SecondComponent {
    void inject(SecondActivity secondActivity);
}
</code></pre><p>ä¸‹é¢æˆ‘ä»¬ç”¨Android Studioä¸­buildèœå•ä¸‹çš„Rebuild Objecté€‰é¡¹å,ä½ ä¼šå‘ç°åˆ›å»ºMainComponentå’ŒSecondComponentå®ä¾‹æ—¶å¤šäº†ä¸€ä¸ªbaseComponentæ–¹æ³•:</p><p><img src=https://img.imgdb.cn/item/605c1ad58322e6675c778ce7.jpg alt=dagger2demo_8.png></p><p>è¿™ä¸ªæ–¹æ³•éœ€è¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªBaseComponentå®ä¾‹,åŸå› å¾ˆç®€å•,MainComponentå’ŒSecondComponentæ—¢ç„¶ä¾èµ–BaseComponent,è‚¯å®šéœ€è¦ä½ ä¼ å…¥ä¸€ä¸ªBaseComponentå®ä¾‹ç»™å®ƒ,å®ƒæ‰èƒ½ä»BaseComponentå®ä¾‹ä¸­è·å–åˆ°å®ƒéœ€è¦çš„å¯¹è±¡å˜›.ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,å¦‚æœè¦MainComponentå’ŒSecondComponentä¾èµ–åˆ°çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªçš„è¯(ä¹Ÿå°±æ˜¯å•ä¾‹),åˆ›å»ºå®ƒä»¬æ˜¯ä¼ å…¥çš„BaseComponentå®ä¾‹ä¹Ÿå¿…é¡»æ˜¯åŒä¸€ä¸ª,ä¸Šé¢è¯´è¿‡,ä¸åŒçš„Componentå®ä¾‹æ˜¯æ— æ³•æä¾›ç›¸åŒçš„ä¾èµ–å®ä¾‹çš„,å› ä¸ºå®ƒä»¬ä¹‹é—´æ˜¯æ²¡æœ‰è”ç³»çš„.è¿™æ ·çš„è¯,æˆ‘ä»¬å°±éœ€è¦åœ¨MainActivityå’ŒSecondActivityä¸­èƒ½è·å–åˆ°åŒä¸€ä¸ªBaseComponentå®ä¾‹,æ€ä¹ˆæ ·èƒ½å®ç°å‘¢?å¾ˆå¤šäººä¸€å¼€å§‹éƒ½ä¼šæƒ³åˆ°ç”¨é™æ€å·¥å‚,è¿™ç§æ–¹æ³•å¯è¡Œ,ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šè‡ªå®šä¹‰ä¸€ä¸ªApplicationç±»,ç”¨å®ƒæ¥æä¾›BaseComponentå®ä¾‹,å› ä¸ºåœ¨æ•´ä¸ªAppç”Ÿå‘½å‘¨æœŸå†…éƒ½åªæœ‰ä¸€ä¸ªApplicationå®ä¾‹,æ‰€ä»¥å…¶ä¸­çš„BaseComponentå®ä¾‹ä¹Ÿä¸ä¼šå˜.æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªMyApplicationç±»</p><pre><code class=language-java>public class MyApplication extends Application {
    private BaseComponent baseComponent;
    @Override
    public void onCreate() {
        super.onCreate();
        baseComponent = DaggerBaseComponent.builder().baseModule(new BaseModule()).build();
    }

    public BaseComponent getBaseComponent() {
        return baseComponent;
    }
}
</code></pre><p>æˆ‘ä»¬åœ¨onCreateæ–¹æ³•ä¸­åˆ›å»ºBaseComponentå®ä¾‹,å¹¶å¯¹å¤–æä¾›è·å–æ–¹æ³•.
è¿™ç§æ–¹å¼è¿˜æœ‰ä¸€ç§å¥½å¤„,å°±æ˜¯å½“æˆ‘ä»¬åœ¨BaseModuleä¸­éœ€è¦ç”¨åˆ°Applicationå®ä¾‹æ—¶,æˆ‘ä»¬å°±å¯ä»¥åœ¨åˆ›å»ºBaseModuleæ—¶ä¼ å…¥<code>this</code>.
æ¥ä¸‹æ¥åœ¨AndroidManifest.xmlä¸­å£°æ˜æˆ‘ä»¬æ–°å»ºçš„MyApplication:</p><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest package=&quot;cn.izouxiang.dagger2demo2&quot;
          xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

    &lt;application
        android:name=&quot;.MyApplication&quot;
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/AppTheme&quot;&gt;
        &lt;activity android:name=&quot;.MainActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;activity android:name=&quot;.SecondActivity&quot;&gt;
        &lt;/activity&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre><p>æ¥ä¸‹æ¥ä¿®æ”¹MainActivityå’ŒSecondActivityä¸­çš„ä»£ç :</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    ...

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        MainComponent build = DaggerMainComponent
                .builder()
                .baseComponent(((MyApplication)getApplication()).getBaseComponent())
                .mainModule(new MainModule())
                .build();
        build.inject(this);
        tv.setText(&quot;çº¢å¸ƒæ–™åŠ å·¥åå˜æˆäº†&quot; + clothHandler.handle(redCloth) + &quot;\nclothHandleråœ°å€:&quot; + clothHandler);
    }

    ...
}
public class SecondActivity extends AppCompatActivity {
   ...

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        ...
        SecondComponent component = DaggerSecondComponent
                .builder()
                .baseComponent(((MyApplication)getApplication()).getBaseComponent())
                .secondModule(new SecondModule())
                .build();
        component.inject(this);
        tv.setText(&quot;è“å¸ƒæ–™åŠ å·¥åå˜æˆäº†&quot; + clothHandler.handle(blueCloth) + &quot;\nclothHandleråœ°å€:&quot; + clothHandler);
    }
}

</code></pre><p>è¿è¡Œç»“æœ:</p><p><img src=https://img.imgdb.cn/item/605c1adf8322e6675c779109.jpg alt=dagger2demo_9.png></p><p>æˆ‘ä»¬æˆåŠŸçš„å°†ClothHandleræ³¨å…¥åˆ°äº†è¿™ä¸¤ä¸ªActivityä¸­,å¹¶ä¸”è¿˜å®ç°äº†å•ä¾‹.(æ³¨æ„:è¿™é‡Œèƒ½å®ç°å•ä¾‹è·ŸBaseComponentä¸­å£°æ˜äº†<code>@Singleton</code>æœ‰å¾ˆå¤§å…³ç³»,å› ä¸ºBaseComponentéƒ½æ²¡æœ‰å•ä¾‹çš„è¯,å¤–éƒ¨ä¾èµ–å®ƒçš„Componentå°±æ›´ä¸å¯èƒ½å•ä¾‹äº†).</p><h2 id=subcomponentæ³¨è§£>@Subcomponentæ³¨è§£</h2><p><code>@Subcomponent</code>æ³¨è§£çš„åŠŸèƒ½å’Œcomponentä¾èµ–ç±»ä¼¼,ä½†æ˜¯ä½¿ç”¨æ–¹æ³•æœ‰ç‚¹ä¸åŒ,componentä¾èµ–éœ€è¦åœ¨è¢«ä¾èµ–çš„Component(ä¸‹æ–‡ä¸­ç§°ä¸ºçˆ¶ç»„ä»¶)ä¸­æš´éœ²æ¥å£,æ²¡æœ‰æš´éœ²æ¥å£çš„ç±»å‹åœ¨ä¾èµ–æ–¹Component(ä¸‹æ–‡ä¸­ç§°ä¸ºå­ç»„ä»¶)æ˜¯è·å–ä¸åˆ°çš„,ä½†æ˜¯é€šè¿‡<code>@Subcomponent</code>,å­ç»„ä»¶å¯ä»¥è·å–åˆ°æ‰€æœ‰çˆ¶ç»„ä»¶èƒ½æä¾›çš„ç±»å‹,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹<code>@Subcomponent</code>æ³¨è§£çš„ä½¿ç”¨æ–¹æ³•:
å…ˆå£°æ˜ä¸€ä¸ªSubMainComponentç»„ä»¶æ¥å£,è¿™é‡Œçš„å£°æ˜æ–¹å¼å’Œæœ€åŸºæœ¬çš„Componentæ¥å£å£°æ˜æ–¹å¼å·®åˆ«ä¸å¤§,åªæ˜¯è¦å°†æ¥å£ä¸Šçš„<code>@Component</code>æ³¨è§£æ”¹ä¸º<code>@Subcomponent</code>æ³¨è§£</p><pre><code class=language-java>@PerActivity
@Subcomponent(modules = MainModule.class)
public interface SubMainComponent {
    void inject(MainActivity activity);
}
</code></pre><p>è¿™ä¸€æ­¥æ˜¯é‡ç‚¹,æˆ‘ä»¬éœ€è¦åœ¨çˆ¶ç»„ä»¶ä¸­å£°æ˜ä¸€ä¸ªè¿”å›å€¼ä¸ºå­ç»„ä»¶çš„æ–¹æ³•,å½“å­ç»„ä»¶éœ€è¦ä»€ä¹ˆModuleæ—¶,å°±åœ¨è¯¥æ–¹æ³•ä¸­æ·»åŠ è¯¥ç±»å‹çš„å‚æ•°</p><pre><code class=language-java>@Singleton
@Component(modules = BaseModule.class)
public interface BaseComponent {
    //è¿™ä¸ªæ˜¯ä¸ºç¬¬äºŒä¸ªActivityå‡†å¤‡çš„,ä¹Ÿå°±æ˜¯dependenciesä¾èµ–å£°æ˜çš„æ–¹å¼
    ClothHandler getClothHandler();

    //@Subcomponentä½¿ç”¨çš„å£°æ˜æ–¹å¼,å£°æ˜ä¸€ä¸ªè¿”å›å€¼ä¸ºå­ç»„ä»¶çš„æ–¹æ³•,å­ç»„ä»¶éœ€è¦ä»€ä¹ˆModule,å°±åœ¨æ–¹æ³•å‚æ•°ä¸­æ·»åŠ ä»€ä¹ˆ
    SubMainComponent getSubMainComponent(MainModule module);
}
</code></pre><p>æœ€åä¿®æ”¹MainActivity:è¿˜æ˜¯å…ˆè·å–åˆ°BaseComponent,å†è°ƒç”¨getSubMainComponent()æ–¹æ³•,å½“ä¸­ä¼ å…¥SubMainComponentç»„ä»¶éœ€è¦çš„MainModule,è¿™æ ·æˆ‘ä»¬å°±è·å–åˆ°äº†ç»§æ‰¿äº†BaseComponentç»„ä»¶çš„SubMainComponentç»„ä»¶,å†è°ƒç”¨ä¸€ä¸‹injectæ–¹æ³•å®Œæˆæ³¨å…¥å°±okäº†</p><pre><code class=language-java>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    tv = (TextView) findViewById(R.id.tv);
    MyApplication application = (MyApplication) getApplication();
    application.getBaseComponent().getSubMainComponent(new MainModule()).inject(this);
    tv.setText(&quot;çº¢å¸ƒæ–™åŠ å·¥åå˜æˆäº†&quot; + clothHandler.handle(redCloth) + &quot;\nclothHandleråœ°å€:&quot; + clothHandler);
}
</code></pre><p>æœ€åæŸ¥çœ‹ç»“æœ</p><p><img src=https://img.imgdb.cn/item/605c1aee8322e6675c77983f.jpg alt=dagger2demo_10.png></p><p>è¿™é‡Œæˆ‘ä»¬å‘ç°,è™½ç„¶ç¬¬ä¸€ä¸ªActivityä½¿ç”¨çš„æ˜¯<code>@subcomponent</code>æ–¹å¼,ç¬¬äºŒä¸ªä½¿ç”¨çš„æ˜¯dependenciesä¾èµ–çš„æ–¹å¼,ä½†æ˜¯ClothHandlerè¿˜æ˜¯å®ç°äº†å•ä¾‹,å‡ºç°è¿™ä¸ªåŸå› æˆ‘ä»¬ä¸Šé¢ä¹Ÿè®²åˆ°äº†,å› ä¸ºè¿™ä¸¤ä¸ªActivityä¸­ç”¨åˆ°çš„BaseComponentæ˜¯åŒä¸€ä¸ªå®ä¾‹,å› ä¸ºåœ¨BaseComponentä¸­ClothHandleræ˜¯å•ä¾‹çš„,é‚£ä¹ˆé€šè¿‡BaseComponentæä¾›çš„ClothHandlerçš„è‚¯å®šä¹Ÿæ˜¯å•ä¾‹çš„å˜›
è¿™é‡Œæ€»ç»“ä¸€ä¸‹<code>@Subcomponent</code>çš„ä½¿ç”¨:</p><ul><li>å­ç»„ä»¶çš„å£°æ˜æ–¹å¼ç”±<code>@Component</code>æ”¹ä¸º<code>@Subcomponent</code></li><li>åœ¨çˆ¶ç»„ä»¶ä¸­è¦å£°æ˜ä¸€ä¸ªè¿”å›å€¼ä¸ºå­ç»„ä»¶çš„æ–¹æ³•,å½“å­ç»„ä»¶éœ€è¦ä»€ä¹ˆModuleæ—¶,å°±åœ¨è¯¥æ–¹æ³•ä¸­æ·»åŠ è¯¥ç±»å‹çš„å‚æ•°</li></ul><blockquote><p>æ³¨æ„:ç”¨<code>@Subcomponent</code>æ³¨è§£å£°æ˜çš„Componentæ˜¯æ— æ³•å•ç‹¬ä½¿ç”¨çš„,æƒ³è¦è·å–è¯¥Componentå®ä¾‹å¿…é¡»ç»è¿‡å…¶çˆ¶ç»„ä»¶</p></blockquote><h2 id=lazyä¸provider>Lazyä¸Provider</h2><p>Lazyå’ŒProvideréƒ½æ˜¯ç”¨äºåŒ…è£…Containerä¸­éœ€è¦è¢«æ³¨å…¥çš„ç±»å‹,Lazyç”¨äºå»¶è¿ŸåŠ è½½,æ‰€è°“çš„æ‡’åŠ è½½å°±æ˜¯å½“ä½ éœ€è¦ç”¨åˆ°è¯¥ä¾èµ–å¯¹è±¡æ—¶,Dagger2æ‰å¸®ä½ å»è·å–ä¸€ä¸ª;Provideç”¨äºå¼ºåˆ¶é‡æ–°åŠ è½½,ä¹Ÿå°±æ˜¯æ¯ä¸€è¦ç”¨åˆ°ä¾èµ–å¯¹è±¡æ—¶,Dagger2éƒ½ä¼šå¸®ä½ ä¾èµ–æ³¨å…¥ä¸€æ¬¡,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸ªå°ä¾‹å­:
ä¿®æ”¹MainModuleç±»</p><pre><code class=language-java>@Module
public class MainModule {
    private static final String TAG = &quot;MainModule&quot;;
    //æ³¨æ„:è¿™é‡Œæ²¡æœ‰å£°æ˜ä½œç”¨åŸŸå†…å•ä¾‹
    @Provides
    public Cloth getRedCloth() {
        Log.d(TAG, &quot;getRedCloth: ...&quot;);
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }
	//æ³¨æ„:è¿™é‡Œæ²¡æœ‰å£°æ˜ä½œç”¨åŸŸå†…å•ä¾‹
    @Provides
    public Shoe getShoe(){
        Log.d(TAG, &quot;getShoe: ...&quot;);
        return new Shoe();
    }
}
</code></pre><p>å†ä¿®æ”¹MainActivityç±»</p><pre><code class=language-java>public class MainActivity extends AppCompatActivity {
    private static final String TAG = &quot;MainActivity&quot;;
    @Inject //Lazyå£°æ˜æ–¹å¼
    Lazy&lt;Cloth&gt; redCloth;
    @Inject //Providerå£°æ˜æ–¹å¼
    Provider&lt;Shoe&gt; shoe;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = (TextView) findViewById(R.id.tv);
        MyApplication application = (MyApplication) getApplication();
        //è¿™é‡Œè™½ç„¶æ²¡ä½¿ç”¨åˆ°BaseComponent,ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¾—ä¼ å…¥BaseComponent,ä¸ç„¶Dagger2ä¼šæŠ¥é”™
        MainComponent component = DaggerMainComponent.builder().baseComponent(application.getBaseComponent()).mainModule(new MainModule()).build();
        component.inject(this);
        Log.d(TAG, &quot;inject done ...&quot;);
        Log.d(TAG, &quot;1 use redCloth instance ..&quot;);
        Log.d(TAG, &quot;redCloth:&quot; + redCloth.get());
        Log.d(TAG, &quot;2 use redCloth instance ..&quot;);
        Log.d(TAG, &quot;redCloth:&quot; + redCloth.get());
        Log.d(TAG, &quot;1 use shoe instance ..&quot;);
        Log.d(TAG, &quot;shoe:&quot; + shoe.get());
        Log.d(TAG, &quot;2 use shoe instance ..&quot;);
        Log.d(TAG, &quot;shoe:&quot; + shoe.get());
    }

    public void onClick(View v) {
        Intent intent = new Intent(this, SecondActivity.class);
        startActivity(intent);
    }
}
</code></pre><p>å…¶ä¸­Lazyå’ŒProviderçš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ä½¿ç”¨è¯¥ç±»ä½œä¸ºå­—æ®µ,æ³›å‹ç±»å‹å°±æ˜¯ä½ è¦ä¾èµ–çš„ç±»å‹,å½“æˆ‘ä»¬è¦è·å–è¯¥å¯¹è±¡æ—¶,ä½¿ç”¨è¯¥ç±»çš„getæ–¹æ³•å°±è¡Œäº†.
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿è¡Œç»“æœ</p><p><img src=https://img.imgdb.cn/item/605c1af78322e6675c779d2d.jpg alt=dagger2demo_11.png></p><p>ä½ ä¼šå‘ç°,clothå’Œshoeéƒ½æ˜¯ä½¿ç”¨æ—¶æ‰å»è°ƒç”¨moduleä¸­çš„æ–¹æ³•,ä¸åŒçš„æ˜¯,clothåªä¼šè°ƒç”¨ä¸€æ¬¡,è€Œshoeæ¯æ¬¡éƒ½ä¼šè°ƒç”¨moduleä¸­çš„æ–¹æ³•,å³å¯¹shoeé‡æ–°æ³¨å…¥,è¿™ä¹Ÿå°±æ˜¯Lazyå’ŒProviderçš„åŒºåˆ«.
ä¸Šé¢çš„MainModuleä¸­æ˜¯æ²¡æœ‰å£°æ˜ä½œç”¨åŸŸå†…å•ä¾‹çš„,ç°åœ¨æˆ‘ä»¬å£°æ˜ä¸€ä¸‹å†çœ‹çœ‹ç»“æœæœ‰æ²¡æœ‰ä»€ä¹ˆå˜åŒ–:
ä¿®æ”¹MainModule</p><pre><code class=language-java>@Module
public class MainModule {
    private static final String TAG = &quot;MainModule&quot;;
    @PerActivity //è¿™é‡Œå£°æ˜ä½œç”¨åŸŸå†…å•ä¾‹
    @Provides
    public Cloth getRedCloth() {
        Log.d(TAG, &quot;getRedCloth: ...&quot;);
        Cloth cloth = new Cloth();
        cloth.setColor(&quot;çº¢è‰²&quot;);
        return cloth;
    }

    @PerActivity //è¿™é‡Œå£°æ˜ä½œç”¨åŸŸå†…å•ä¾‹
    @Provides
    public Shoe getShoe(){
        Log.d(TAG, &quot;getShoe: ...&quot;);
        return new Shoe();
    }
}
</code></pre><p>æŸ¥çœ‹ç»“æœ:</p><p><img src=https://img.imgdb.cn/item/605c1aff8322e6675c77a11c.jpg alt=dagger2demo_12.png></p><p>å‘ç°,å£°æ˜å•ä¾‹å,ä½¿ç”¨shoeæ—¶ä¹Ÿä¸ä¼šæ¯æ¬¡éƒ½å»è°ƒç”¨moduleä¸­çš„æ–¹æ³•äº†,è¿™æ˜¯å› ä¸ºProviderçš„ä½œç”¨æ˜¯æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½å¯¹ä¾èµ–å¯¹è±¡é‡æ–°æ³¨å…¥,ä½†æ˜¯Shoeåœ¨Componentä¸­æ˜¯å•ä¾‹çš„,æ‰€ä»¥æ¯æ¬¡æ³¨å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹,æ‰€ä»¥åªä¼šè°ƒç”¨ä¸€æ¬¡moduleä¸­çš„æ–¹æ³•.</p><h2 id=componentçš„ç”Ÿå‘½å‘¨æœŸ>Componentçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯åœ¨Activityçš„onCreateæ–¹æ³•ä¸­åˆ›å»ºComponentå®ä¾‹,å†è°ƒç”¨injectæ–¹æ³•å®Œæˆä¾èµ–.æ‰€ä»¥Componentä¾èµ–å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹:</p><ol><li>åˆ›å»ºComponentå®ä¾‹<pre><code class=language-java>MainComponent component = DaggerMainComponent
            .builder()
            .baseComponent(((MyApplication)getApplication()).getBaseComponent())
            .mainModule(new MainModule())
            .build();
</code></pre></li><li>è°ƒç”¨injectæ–¹æ³•<pre><code class=language-java>component.inject(this);
</code></pre><p>è°ƒç”¨å®Œè¿™ä¸ªæ–¹æ³•æ•´ä¸ªä¾èµ–å°±å®Œæˆäº†.</p></li><li>Componentå®ä¾‹è¢«é”€æ¯
onCreate()æ–¹æ³•è°ƒç”¨å®Œæˆå,Componentå®ä¾‹å°±ä¼šå› ä¸ºæ²¡æœ‰è¢«å¼•ç”¨è€Œè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶.å…¶ä¸­ä¼ å…¥ç»™Componentå®ä¾‹çš„Moduleå®ä¾‹ä¹Ÿä¼šä¸€åŒè¢«å›æ”¶,è¿™ä¹Ÿå°±èƒ½è¯´æ˜ä¸åŒçš„Componentå®ä¾‹ä¹‹é—´æ˜¯æ²¡æœ‰è”ç³»çš„(Componentä¾èµ–é™¤å¤–).è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯,ä½¿ç”¨Lazyå’ŒProvideræ—¶,ä¸è¯¥ä¾èµ–å¯¹è±¡æœ‰å…³çš„Moduleå®ä¾‹ä¼šè¢«Lazyå’ŒProviderå¼•ç”¨,æ‰€ä»¥è¯¥Moduleå®ä¾‹ä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</li></ol><h2 id=æ€»ç»“>æ€»ç»“</h2><ul><li>è‡³æ­¤,Dagger2åŸºç¡€å·²è®²å®Œ,å¯¹äºDagger2åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨æ–¹æ³•,å¯ä»¥å‚è€ƒgithubä¸Šçš„å¼€æºé¡¹ç›®.å¸Œæœ›æ­¤ç¯‡æ–‡ç« èƒ½å¤Ÿå¯¹ä½ æœ‰æ‰€å¸®åŠ©!</li><li>æœ¬ç¯‡æ–‡ç« æ˜¯ç¬”è€…ç”¨æ¥è®°å½•è‡ªå·±å¯¹Dagger2çš„ç†è§£çš„,å¦‚æœå½“ä¸­æœ‰é”™è¯¯,è¿˜è¯·èµæ•™,ä»¥ä¾¿ç¬”è€…çº æ­£.</li><li>èƒ½å¤Ÿä¹¦å†™æœ¬ç¯‡æ–‡ç« ,è¿˜å¾—å¤šäºäº†å„ä½å¤§ç¥çš„blog,æ­£å› ä¸ºå„ä½å¤§ç¥çš„åˆ†äº«ç²¾ç¥,æ‰è®©æˆ‘ä»¬è¿™ç§å°èœé¸Ÿèƒ½å¤Ÿæˆé•¿.æ­¤ç¯‡æ–‡ç« åˆ†äº«å‡ºæ¥çš„ç›®çš„ä¹Ÿå°±æ˜¯ä¸ºäº†ä¼ æ‰¿è¿™ç§ç²¾ç¥</li></ul><p>æœ€åæˆ‘ä»¬å¼•ç”¨ä¸€ä¸‹<a href=http://blog.piasy.com/2016/04/11/Dagger2-Scope-Instance/>Dagger2 Scope æ³¨è§£èƒ½ä¿è¯ä¾èµ–åœ¨ component ç”Ÿå‘½å‘¨æœŸå†…çš„å•ä¾‹æ€§å—ï¼Ÿ</a>ä¸­çš„æ³¨æ„äº‹é¡¹:</p><blockquote><ul><li>component çš„ inject å‡½æ•°ä¸è¦å£°æ˜åŸºç±»å‚æ•°ï¼›</li></ul></blockquote><ul><li>Scope æ³¨è§£å¿…é¡»ç”¨åœ¨ module çš„ provide æ–¹æ³•ä¸Šï¼Œå¦åˆ™å¹¶ä¸èƒ½è¾¾åˆ°å±€éƒ¨å•ä¾‹çš„æ•ˆæœï¼›</li><li>å¦‚æœ module çš„ provide æ–¹æ³•ä½¿ç”¨äº† scope æ³¨è§£ï¼Œé‚£ä¹ˆ component å°±å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ï¼Œå¦åˆ™ç¼–è¯‘ä¼šå¤±è´¥ï¼›</li><li>å¦‚æœ module çš„ provide æ–¹æ³•æ²¡æœ‰ä½¿ç”¨ scope æ³¨è§£ï¼Œé‚£ä¹ˆ component å’Œ module æ˜¯å¦åŠ æ³¨è§£éƒ½æ— å…³ç´§è¦ï¼Œå¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯æ²¡æœ‰å±€éƒ¨å•ä¾‹æ•ˆæœï¼›</li><li>å¯¹äºç›´æ¥ä½¿ç”¨ @Inject æ„é€ å‡½æ•°çš„ä¾èµ–ï¼Œå¦‚æœæŠŠ scope æ³¨è§£æ”¾åˆ°å®ƒçš„ç±»ä¸Šï¼Œè€Œä¸æ˜¯æ„é€ å‡½æ•°ä¸Šï¼Œå°±èƒ½è¾¾åˆ°å±€éƒ¨å•ä¾‹çš„æ•ˆæœäº†ï¼›</li></ul><p>ç¬”è€…å†æ€»ç»“</p><ul><li>è¢«ä¾èµ–çš„Componentèƒ½æä¾›æŸä¸ªå¯¹è±¡æ—¶,ä¸€å®šè¦åœ¨æ¥å£ä¸­å£°æ˜ä»¥è¯¥å¯¹è±¡ä¸ºè¿”å›å€¼çš„æ–¹æ³•(ä¹Ÿå°±æ˜¯æš´éœ²æ¥å£).è¿™æ ·ä¾èµ–å®ƒçš„Componentæ‰èƒ½è·å–åˆ°è¿™ç§å¯¹è±¡.</li></ul><h2 id=å£°æ˜>å£°æ˜</h2><p><strong>æœ¬æ–‡ä¸ºç¬”è€…åŸåˆ›æ–‡ç« ,è½¬è½½éœ€è¯´æ˜!</strong></p><h2 id=å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« </h2><blockquote><p><a href="https://dreamerhome.github.io/2016/07/07/dagger/?utm_source=tuicool&utm_medium=referral">ä¾èµ–æ³¨å…¥ç¥å™¨ï¼šDagger2è¯¦è§£ç³»åˆ—</a>
<a href=http://blog.piasy.com/2016/04/11/Dagger2-Scope-Instance/>Dagger2 Scope æ³¨è§£èƒ½ä¿è¯ä¾èµ–åœ¨ component ç”Ÿå‘½å‘¨æœŸå†…çš„å•ä¾‹æ€§å—ï¼Ÿ</a>
<a href=https://github.com/codeestX/GeekNews>GeekNews</a>
<a href=https://github.com/luxiaoming/dagger2Demo>Dagger2å›¾æ–‡å®Œå…¨æ•™ç¨‹</a>
<a href=http://blog.csdn.net/duo2005duo/article/details/50696166>Androidå¸¸ç”¨å¼€æºå·¥å…·ï¼ˆ2ï¼‰-Dagger2è¿›é˜¶</a></p></blockquote></div><div class=post-copyright><p class=copyright-item><span class=item-title>æ–‡ç« ä½œè€…</span>
<span class=item-content>Fxzou</span></p><p class=copyright-item><span class=item-title>ä¸Šæ¬¡æ›´æ–°</span>
<span class=item-content>2016-12-21</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/dagger2/>Dagger2</a>
<a href=/tags/%E6%95%99%E7%A8%8B/>æ•™ç¨‹</a>
<a href=/tags/android/>Android</a></div><nav class=post-nav><a class=prev href=/post/java/spring_joinpoint/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Spring JoinPointçš„ç”¨æ³•</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/android/bezier/><span class="next-text nav-default">Android-ä½¿ç”¨è´å¡å°”æ›²çº¿å°†å¤šç‚¹è¿æˆä¸€æ¡å¹³æ»‘çš„æ›²çº¿</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=zFxiang/zfxiang.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=https://github.com/zFxiang class="iconfont icon-github" title=github></a><a href=https://zfxiang.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>ç”± <a class=hexo-link href=https://gohugo.io>Hugo</a> å¼ºåŠ›é©±åŠ¨</span>
<span class=division>|</span>
<span class=theme-info>ä¸»é¢˜ -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Fxzou</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin=anonymous></script><script>var languageCode="zh-cn".replace(/-/g,'_').replace(/_(.*)/,function(b,a){return b.replace(a,a.toUpperCase())});timeago().render(document.querySelectorAll('.timeago'),languageCode),timeago.cancel()</script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script></body></html>